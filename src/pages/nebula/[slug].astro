---
import Layout from '../../layouts/MainLayout.astro';
import ConfigReference from '../../components/ConfigReference.astro';
import {DEFAULT_LOCALE} from '../../languages';
import {frontmatter as configRef} from '../../data/config-reference.md';

/**
 * This file is used for urls without a locale, which means they are for the default language.
 */

export async function getStaticPaths() {
  const allPages = await Astro.glob('../../data/docs/en/**/*.md');

  const paths = allPages.map(({ Content, frontmatter }) => {
    return {
      params: {
        slug: frontmatter.slug
      },
      props: {
        page: {
          ...frontmatter,
          Content,
        }
      }
    }
  })

  // Filter out any paths with an undefined locale or slug.
  return paths.filter(({ params }) => !!params.slug);
}

const { 
  /** Contains the frontmatter from the page data, including title, summary, etc. */
  page, 
} = Astro.props

const isConfigRefPage = page.slug === 'config';

if (isConfigRefPage) {
  const configOptions = configRef[DEFAULT_LOCALE].options;
  const optionHeaders = configOptions.map(option => ({depth: 2, slug: option.name, text: option.name}))
  page.headers = optionHeaders;
}
---

<Layout content={page}>
    <page.Content />
    {isConfigRefPage && <ConfigReference locale={DEFAULT_LOCALE}/>}
</Layout>
